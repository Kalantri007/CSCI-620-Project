{"ast":null,"code":"var _jsxFileName = \"/home/vkalantri/CSCI-620-Project/chess_app/frontend/src/pages/HomePage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport api from '../services/api';\nimport '../styles/HomePage.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst HomePage = () => {\n  _s();\n  const [games, setGames] = useState([]);\n  const [invitations, setInvitations] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [username, setUsername] = useState('');\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState('');\n  const [showNewGameModal, setShowNewGameModal] = useState(false);\n  const [lobbySocket, setLobbySocket] = useState(null);\n  const navigate = useNavigate();\n  const setupLobbyWebSocket = () => {\n    const wsScheme = window.location.protocol === 'https:' ? 'wss://' : 'ws://';\n    const token = localStorage.getItem('authToken');\n\n    // Include token in WebSocket URL for authentication\n    const socket = new WebSocket(`${wsScheme}127.0.0.1:8000/ws/lobby/?token=${token}`);\n    let reconnectAttempts = 0;\n    let reconnectTimer = null;\n    const maxReconnectAttempts = 5;\n    socket.onopen = () => {\n      console.log('Lobby WebSocket connected');\n      reconnectAttempts = 0; // Reset reconnect attempts on successful connection\n\n      // Clear any reconnect timers if we connected successfully\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n        reconnectTimer = null;\n      }\n    };\n    socket.onmessage = e => {\n      const data = JSON.parse(e.data);\n      console.log('Received lobby message:', data);\n      if (data.type === 'connection_established') {\n        console.log('WebSocket connection confirmed by server');\n      } else if (data.type === 'error') {\n        console.error('Server error:', data.message);\n      } else if (data.type === 'challenge') {\n        // Received a game challenge\n        fetchInvitations(); // Refresh invitations list\n      } else if (data.type === 'challenge_response') {\n        // Someone responded to a challenge\n        fetchGames(); // Refresh games list\n        fetchInvitations(); // Refresh invitations list\n      } else if (data.type === 'user_online' || data.type === 'user_offline') {\n        // User status changed\n        fetchUsers(); // Refresh users list\n      }\n    };\n    socket.onclose = e => {\n      console.log('Lobby WebSocket disconnected');\n\n      // Only attempt to reconnect if it wasn't a normal closure and we haven't exceeded max attempts\n      if (e.code !== 1000 && reconnectAttempts < maxReconnectAttempts) {\n        reconnectAttempts++;\n\n        // Calculate delay with exponential backoff (1s, 2s, 4s, etc.)\n        const delay = Math.min(1000 * 2 ** reconnectAttempts, 30000);\n        console.log(`Attempting to reconnect in ${delay / 1000} seconds... (Attempt ${reconnectAttempts}/${maxReconnectAttempts})`);\n        reconnectTimer = setTimeout(() => {\n          console.log('Attempting to reconnect to lobby WebSocket...');\n          const newSocket = setupLobbyWebSocket();\n          setLobbySocket(newSocket);\n        }, delay);\n      }\n    };\n    socket.onerror = error => {\n      console.error('Lobby WebSocket error:', error);\n    };\n    return socket;\n  };\n  useEffect(() => {\n    // Check if user is authenticated\n    const token = localStorage.getItem('authToken');\n    const storedUsername = localStorage.getItem('username');\n    if (token && storedUsername) {\n      setIsAuthenticated(true);\n      setUsername(storedUsername);\n\n      // Fetch active games, invitations, and online users\n      fetchGames();\n      fetchInvitations();\n      fetchUsers();\n\n      // Set up WebSocket connection for lobby\n      const socket = setupLobbyWebSocket();\n      setLobbySocket(socket);\n    } else {\n      setLoading(false);\n    }\n    return () => {\n      // Clean up WebSocket connection\n      if (lobbySocket) {\n        lobbySocket.close(1000, \"Component unmounting\"); // Normal closure\n      }\n    };\n  }, []);\n  const fetchGames = async () => {\n    try {\n      const data = await api.getGames();\n      setGames(data);\n      setLoading(false);\n    } catch (error) {\n      console.error('Error fetching games:', error);\n      setError('Failed to load games');\n      setLoading(false);\n    }\n  };\n  const fetchInvitations = async () => {\n    try {\n      const data = await api.getInvitations();\n      setInvitations(data);\n    } catch (error) {\n      console.error('Error fetching invitations:', error);\n    }\n  };\n  const fetchUsers = async () => {\n    try {\n      const data = await api.getUsers();\n      // Filter out current user\n      setUsers(data.filter(user => user.username !== username));\n    } catch (error) {\n      console.error('Error fetching users:', error);\n    }\n  };\n  const handleLogout = async () => {\n    try {\n      await api.logout();\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('username');\n      setIsAuthenticated(false);\n    } catch (error) {\n      console.error('Error during logout:', error);\n    }\n  };\n  const handleCreateGame = async () => {\n    if (!selectedUser) {\n      alert('Please select an opponent');\n      return;\n    }\n    try {\n      await api.createInvitation({\n        recipient: selectedUser\n      });\n      setShowNewGameModal(false);\n      setSelectedUser('');\n      fetchInvitations();\n    } catch (error) {\n      console.error('Error creating game invitation:', error);\n      alert('Failed to create game invitation. Please try again.');\n    }\n  };\n  const handleAcceptInvitation = async invitationId => {\n    try {\n      const game = await api.acceptInvitation(invitationId);\n      navigate(`/game/${game.id}`);\n    } catch (error) {\n      console.error('Error accepting invitation:', error);\n      alert('Failed to accept invitation. Please try again.');\n    }\n  };\n  const handleDeclineInvitation = async invitationId => {\n    try {\n      await api.declineInvitation(invitationId);\n      fetchInvitations();\n    } catch (error) {\n      console.error('Error declining invitation:', error);\n      alert('Failed to decline invitation. Please try again.');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"app-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Chess App\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this), isAuthenticated ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\"Welcome, \", username, \"!\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleLogout,\n          className: \"logout-btn\",\n          children: \"Logout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"auth-links\",\n        children: [/*#__PURE__*/_jsxDEV(Link, {\n          to: \"/login\",\n          className: \"btn\",\n          children: \"Login\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/register\",\n          className: \"btn\",\n          children: \"Register\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }, this), isAuthenticated ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"dashboard\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"games-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"section-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Your Active Games\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowNewGameModal(true),\n            className: \"create-game-btn\",\n            children: \"Start New Game\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 13\n        }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Loading games...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 15\n        }, this) : error ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"error-message\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 15\n        }, this) : games.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-list\",\n          children: games.filter(game => game.status === 'active').map(game => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"game-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"game-details\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"players\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"white-player\",\n                  children: game.white_player.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 241,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \" vs \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 242,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"black-player\",\n                  children: game.black_player.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 243,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"game-status\",\n                children: game.fen.split(' ')[1] === 'w' ? \"White's turn\" : \"Black's turn\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              to: `/game/${game.id}`,\n              className: \"join-game-btn\",\n              children: \"Join Game\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 23\n            }, this)]\n          }, game.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 21\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"No active games found.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invitations-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Game Invitations\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 13\n        }, this), invitations.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"invitation-list\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Received Invitations\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 17\n          }, this), invitations.filter(inv => inv.recipient.username === username && inv.status === 'pending').map(invitation => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"invitation-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"From: \", invitation.sender.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"invitation-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleAcceptInvitation(invitation.id),\n                className: \"accept-btn\",\n                children: \"Accept\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleDeclineInvitation(invitation.id),\n                className: \"decline-btn\",\n                children: \"Decline\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 277,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 23\n            }, this)]\n          }, invitation.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 21\n          }, this)), /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Sent Invitations\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 17\n          }, this), invitations.filter(inv => inv.sender.username === username && inv.status === 'pending').map(invitation => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"invitation-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"To: \", invitation.recipient.username]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Status: Pending\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 23\n            }, this)]\n          }, invitation.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 21\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"No invitations found.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"completed-games-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Completed Games\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 13\n        }, this), games.filter(game => game.status === 'finished').length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"game-list\",\n          children: games.filter(game => game.status === 'finished').map(game => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"game-item completed\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"game-details\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"players\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"white-player\",\n                  children: game.white_player.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 314,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \" vs \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 315,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"black-player\",\n                  children: game.black_player.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 316,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 313,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"game-result\",\n                children: game.result === 'white_win' ? 'White won' : game.result === 'black_win' ? 'Black won' : 'Draw'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 318,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              to: `/game/${game.id}`,\n              className: \"view-game-btn\",\n              children: \"View Game\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 23\n            }, this)]\n          }, game.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 21\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"No completed games found.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 11\n      }, this), showNewGameModal && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-overlay\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Start New Game\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"opponent\",\n              children: \"Select Opponent:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 339,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n              id: \"opponent\",\n              value: selectedUser,\n              onChange: e => setSelectedUser(e.target.value),\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"Select an opponent\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 345,\n                columnNumber: 21\n              }, this), users.map(user => /*#__PURE__*/_jsxDEV(\"option\", {\n                value: user.id,\n                children: user.username\n              }, user.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 347,\n                columnNumber: 23\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleCreateGame,\n              disabled: !selectedUser,\n              className: \"create-btn\",\n              children: \"Send Invitation\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 352,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setShowNewGameModal(false),\n              className: \"cancel-btn\",\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"welcome-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Welcome to Chess App!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 372,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Please log in or register to start playing.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 199,\n    columnNumber: 5\n  }, this);\n};\n_s(HomePage, \"kNX2Jcszfy2g4CWF8G4q5dxS0NQ=\", false, function () {\n  return [useNavigate];\n});\n_c = HomePage;\nexport default HomePage;\nvar _c;\n$RefreshReg$(_c, \"HomePage\");","map":{"version":3,"names":["React","useEffect","useState","Link","useNavigate","api","jsxDEV","_jsxDEV","HomePage","_s","games","setGames","invitations","setInvitations","loading","setLoading","error","setError","isAuthenticated","setIsAuthenticated","username","setUsername","users","setUsers","selectedUser","setSelectedUser","showNewGameModal","setShowNewGameModal","lobbySocket","setLobbySocket","navigate","setupLobbyWebSocket","wsScheme","window","location","protocol","token","localStorage","getItem","socket","WebSocket","reconnectAttempts","reconnectTimer","maxReconnectAttempts","onopen","console","log","clearTimeout","onmessage","e","data","JSON","parse","type","message","fetchInvitations","fetchGames","fetchUsers","onclose","code","delay","Math","min","setTimeout","newSocket","onerror","storedUsername","close","getGames","getInvitations","getUsers","filter","user","handleLogout","logout","removeItem","handleCreateGame","alert","createInvitation","recipient","handleAcceptInvitation","invitationId","game","acceptInvitation","id","handleDeclineInvitation","declineInvitation","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","to","length","status","map","white_player","black_player","fen","split","inv","invitation","sender","result","htmlFor","value","onChange","target","disabled","_c","$RefreshReg$"],"sources":["/home/vkalantri/CSCI-620-Project/chess_app/frontend/src/pages/HomePage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport api from '../services/api';\nimport '../styles/HomePage.css';\n\nconst HomePage = () => {\n  const [games, setGames] = useState([]);\n  const [invitations, setInvitations] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [username, setUsername] = useState('');\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState('');\n  const [showNewGameModal, setShowNewGameModal] = useState(false);\n  const [lobbySocket, setLobbySocket] = useState(null);\n  \n  const navigate = useNavigate();\n\n  const setupLobbyWebSocket = () => {\n    const wsScheme = window.location.protocol === 'https:' ? 'wss://' : 'ws://';\n    const token = localStorage.getItem('authToken');\n    \n    // Include token in WebSocket URL for authentication\n    const socket = new WebSocket(`${wsScheme}127.0.0.1:8000/ws/lobby/?token=${token}`);\n    \n    let reconnectAttempts = 0;\n    let reconnectTimer = null;\n    const maxReconnectAttempts = 5;\n    \n    socket.onopen = () => {\n      console.log('Lobby WebSocket connected');\n      reconnectAttempts = 0; // Reset reconnect attempts on successful connection\n      \n      // Clear any reconnect timers if we connected successfully\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n        reconnectTimer = null;\n      }\n    };\n    \n    socket.onmessage = (e) => {\n      const data = JSON.parse(e.data);\n      console.log('Received lobby message:', data);\n      \n      if (data.type === 'connection_established') {\n        console.log('WebSocket connection confirmed by server');\n      } else if (data.type === 'error') {\n        console.error('Server error:', data.message);\n      } else if (data.type === 'challenge') {\n        // Received a game challenge\n        fetchInvitations(); // Refresh invitations list\n      } else if (data.type === 'challenge_response') {\n        // Someone responded to a challenge\n        fetchGames(); // Refresh games list\n        fetchInvitations(); // Refresh invitations list\n      } else if (data.type === 'user_online' || data.type === 'user_offline') {\n        // User status changed\n        fetchUsers(); // Refresh users list\n      }\n    };\n    \n    socket.onclose = (e) => {\n      console.log('Lobby WebSocket disconnected');\n      \n      // Only attempt to reconnect if it wasn't a normal closure and we haven't exceeded max attempts\n      if (e.code !== 1000 && reconnectAttempts < maxReconnectAttempts) {\n        reconnectAttempts++;\n        \n        // Calculate delay with exponential backoff (1s, 2s, 4s, etc.)\n        const delay = Math.min(1000 * (2 ** reconnectAttempts), 30000);\n        \n        console.log(`Attempting to reconnect in ${delay/1000} seconds... (Attempt ${reconnectAttempts}/${maxReconnectAttempts})`);\n        \n        reconnectTimer = setTimeout(() => {\n          console.log('Attempting to reconnect to lobby WebSocket...');\n          const newSocket = setupLobbyWebSocket();\n          setLobbySocket(newSocket);\n        }, delay);\n      }\n    };\n    \n    socket.onerror = (error) => {\n      console.error('Lobby WebSocket error:', error);\n    };\n    \n    return socket;\n  };\n\n  useEffect(() => {\n    // Check if user is authenticated\n    const token = localStorage.getItem('authToken');\n    const storedUsername = localStorage.getItem('username');\n    \n    if (token && storedUsername) {\n      setIsAuthenticated(true);\n      setUsername(storedUsername);\n      \n      // Fetch active games, invitations, and online users\n      fetchGames();\n      fetchInvitations();\n      fetchUsers();\n      \n      // Set up WebSocket connection for lobby\n      const socket = setupLobbyWebSocket();\n      setLobbySocket(socket);\n    } else {\n      setLoading(false);\n    }\n    \n    return () => {\n      // Clean up WebSocket connection\n      if (lobbySocket) {\n        lobbySocket.close(1000, \"Component unmounting\"); // Normal closure\n      }\n    };\n  }, []);\n\n  const fetchGames = async () => {\n    try {\n      const data = await api.getGames();\n      setGames(data);\n      setLoading(false);\n    } catch (error) {\n      console.error('Error fetching games:', error);\n      setError('Failed to load games');\n      setLoading(false);\n    }\n  };\n  \n  const fetchInvitations = async () => {\n    try {\n      const data = await api.getInvitations();\n      setInvitations(data);\n    } catch (error) {\n      console.error('Error fetching invitations:', error);\n    }\n  };\n  \n  const fetchUsers = async () => {\n    try {\n      const data = await api.getUsers();\n      // Filter out current user\n      setUsers(data.filter(user => user.username !== username));\n    } catch (error) {\n      console.error('Error fetching users:', error);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      await api.logout();\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('username');\n      setIsAuthenticated(false);\n    } catch (error) {\n      console.error('Error during logout:', error);\n    }\n  };\n\n  const handleCreateGame = async () => {\n    if (!selectedUser) {\n      alert('Please select an opponent');\n      return;\n    }\n\n    try {\n      await api.createInvitation({ recipient: selectedUser });\n      setShowNewGameModal(false);\n      setSelectedUser('');\n      fetchInvitations();\n    } catch (error) {\n      console.error('Error creating game invitation:', error);\n      alert('Failed to create game invitation. Please try again.');\n    }\n  };\n\n  const handleAcceptInvitation = async (invitationId) => {\n    try {\n      const game = await api.acceptInvitation(invitationId);\n      navigate(`/game/${game.id}`);\n    } catch (error) {\n      console.error('Error accepting invitation:', error);\n      alert('Failed to accept invitation. Please try again.');\n    }\n  };\n\n  const handleDeclineInvitation = async (invitationId) => {\n    try {\n      await api.declineInvitation(invitationId);\n      fetchInvitations();\n    } catch (error) {\n      console.error('Error declining invitation:', error);\n      alert('Failed to decline invitation. Please try again.');\n    }\n  };\n\n  return (\n    <div className=\"home-page\">\n      <header className=\"app-header\">\n        <h1>Chess App</h1>\n        \n        {isAuthenticated ? (\n          <div className=\"user-controls\">\n            <span>Welcome, {username}!</span>\n            <button onClick={handleLogout} className=\"logout-btn\">Logout</button>\n          </div>\n        ) : (\n          <div className=\"auth-links\">\n            <Link to=\"/login\" className=\"btn\">Login</Link>\n            <Link to=\"/register\" className=\"btn\">Register</Link>\n          </div>\n        )}\n      </header>\n\n      {isAuthenticated ? (\n        <div className=\"dashboard\">\n          <div className=\"games-section\">\n            <div className=\"section-header\">\n              <h2>Your Active Games</h2>\n              <button \n                onClick={() => setShowNewGameModal(true)} \n                className=\"create-game-btn\"\n              >\n                Start New Game\n              </button>\n            </div>\n\n            {loading ? (\n              <p>Loading games...</p>\n            ) : error ? (\n              <p className=\"error-message\">{error}</p>\n            ) : games.length > 0 ? (\n              <div className=\"game-list\">\n                {games\n                  .filter(game => game.status === 'active')\n                  .map(game => (\n                    <div key={game.id} className=\"game-item\">\n                      <div className=\"game-details\">\n                        <div className=\"players\">\n                          <span className=\"white-player\">{game.white_player.username}</span>\n                          <span> vs </span>\n                          <span className=\"black-player\">{game.black_player.username}</span>\n                        </div>\n                        <div className=\"game-status\">\n                          {game.fen.split(' ')[1] === 'w' ? \"White's turn\" : \"Black's turn\"}\n                        </div>\n                      </div>\n                      <Link to={`/game/${game.id}`} className=\"join-game-btn\">\n                        Join Game\n                      </Link>\n                    </div>\n                  ))}\n              </div>\n            ) : (\n              <p>No active games found.</p>\n            )}\n          </div>\n\n          <div className=\"invitations-section\">\n            <h2>Game Invitations</h2>\n            {invitations.length > 0 ? (\n              <div className=\"invitation-list\">\n                <h3>Received Invitations</h3>\n                {invitations\n                  .filter(inv => inv.recipient.username === username && inv.status === 'pending')\n                  .map(invitation => (\n                    <div key={invitation.id} className=\"invitation-item\">\n                      <p>From: {invitation.sender.username}</p>\n                      <div className=\"invitation-actions\">\n                        <button \n                          onClick={() => handleAcceptInvitation(invitation.id)}\n                          className=\"accept-btn\"\n                        >\n                          Accept\n                        </button>\n                        <button \n                          onClick={() => handleDeclineInvitation(invitation.id)}\n                          className=\"decline-btn\"\n                        >\n                          Decline\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                \n                <h3>Sent Invitations</h3>\n                {invitations\n                  .filter(inv => inv.sender.username === username && inv.status === 'pending')\n                  .map(invitation => (\n                    <div key={invitation.id} className=\"invitation-item\">\n                      <p>To: {invitation.recipient.username}</p>\n                      <p>Status: Pending</p>\n                    </div>\n                  ))}\n              </div>\n            ) : (\n              <p>No invitations found.</p>\n            )}\n          </div>\n          \n          <div className=\"completed-games-section\">\n            <h2>Completed Games</h2>\n            {games\n              .filter(game => game.status === 'finished')\n              .length > 0 ? (\n              <div className=\"game-list\">\n                {games\n                  .filter(game => game.status === 'finished')\n                  .map(game => (\n                    <div key={game.id} className=\"game-item completed\">\n                      <div className=\"game-details\">\n                        <div className=\"players\">\n                          <span className=\"white-player\">{game.white_player.username}</span>\n                          <span> vs </span>\n                          <span className=\"black-player\">{game.black_player.username}</span>\n                        </div>\n                        <div className=\"game-result\">\n                          {game.result === 'white_win' ? 'White won' : \n                           game.result === 'black_win' ? 'Black won' : 'Draw'}\n                        </div>\n                      </div>\n                      <Link to={`/game/${game.id}`} className=\"view-game-btn\">\n                        View Game\n                      </Link>\n                    </div>\n                  ))}\n              </div>\n            ) : (\n              <p>No completed games found.</p>\n            )}\n          </div>\n\n          {showNewGameModal && (\n            <div className=\"modal-overlay\">\n              <div className=\"modal\">\n                <h2>Start New Game</h2>\n                <div className=\"form-group\">\n                  <label htmlFor=\"opponent\">Select Opponent:</label>\n                  <select \n                    id=\"opponent\"\n                    value={selectedUser}\n                    onChange={(e) => setSelectedUser(e.target.value)}\n                  >\n                    <option value=\"\">Select an opponent</option>\n                    {users.map(user => (\n                      <option key={user.id} value={user.id}>{user.username}</option>\n                    ))}\n                  </select>\n                </div>\n                <div className=\"modal-actions\">\n                  <button \n                    onClick={handleCreateGame} \n                    disabled={!selectedUser}\n                    className=\"create-btn\"\n                  >\n                    Send Invitation\n                  </button>\n                  <button \n                    onClick={() => setShowNewGameModal(false)}\n                    className=\"cancel-btn\"\n                  >\n                    Cancel\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      ) : (\n        <div className=\"welcome-section\">\n          <h2>Welcome to Chess App!</h2>\n          <p>Please log in or register to start playing.</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default HomePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}